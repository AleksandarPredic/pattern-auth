/*
    patternLock.js v 0.4.1
    Author: Sudhanshu Yadav
    Copyright (c) 2013 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo and documentaion on: ignitersworld.com/lab/patternLock.html
*/
;!function(t,e,n){"use strict";function r(t){for(var e=t.holder,n=t.option,r=n.matrix,a=n.margin,o=n.radius,i=['<ul class="patt-wrap" style="padding:'+a+'px">'],s=0,l=r[0]*r[1];l>s;s++)i.push('<li class="patt-circ" style="margin:'+a+"px; width : "+2*o+"px; height : "+2*o+"px; -webkit-border-radius: "+o+"px; -moz-border-radius: "+o+"px; border-radius: "+o+'px; "><div class="patt-dots"></div></li>');i.push("</ul>"),e.html(i.join("")).css({width:r[1]*(2*o+2*a)+2*a+"px",height:r[0]*(2*o+2*a)+2*a+"px"}),t.pattCircle=t.holder.find(".patt-circ")}function a(t,e,n,r){var a=e-t,o=r-n;return{length:Math.ceil(Math.sqrt(a*a+o*o)),angle:Math.round(180*Math.atan2(o,a)/Math.PI)}}function o(){}function i(e,n){var a=this,h=a.token=Math.random(),d=l[h]=new o,u=d.holder=t(e);if(0!=u.length){d.object=a,n=d.option=t.extend({},i.defaults,n),r(d),u.addClass("patt-holder"),"static"==u.css("position")&&u.css("position","relative"),u.on("touchstart mousedown",function(t){p.call(this,t,a)}),d.option.onDraw=n.onDraw||s;var c=n.mapper;d.mapperFunc="object"==typeof c?function(t){return c[t]}:"function"==typeof c?c:s,d.option.mapper=null}}var s=function(){},l={},p=function(e,r){e.preventDefault();var a=l[r.token];if(!a.disabled){a.option.patternVisible||a.holder.addClass("patt-hidden");var o="touchstart"==e.type?"touchmove":"mousemove",i="touchstart"==e.type?"touchend":"mouseup";t(this).on(o+".pattern-move",function(t){h.call(this,t,r)}),t(n).one(i,function(){d.call(this,e,r)});var s=a.holder.find(".patt-wrap"),p=s.offset();a.wrapTop=p.top,a.wrapLeft=p.left,r.reset()}},h=function(e,n){e.preventDefault();var r=e.pageX||e.originalEvent.touches[0].pageX,o=e.pageY||e.originalEvent.touches[0].pageY,i=l[n.token],s=i.pattCircle,p=i.patternAry,h=i.option.lineOnMove,d=i.getIdxFromPoint(r,o),u=d.idx,c=i.mapperFunc(u)||u;if(p.length>0){var f=a(i.lineX1,d.x,i.lineY1,d.y);i.line.css({width:f.length+10+"px",transform:"rotate("+f.angle+"deg)"})}if(u){if(-1==p.indexOf(c)){var v=t(s[u-1]);if(i.lastPosObj)for(var m=i.lastPosObj,g=m.i,x=m.j,b=Math.abs(d.i-g),w=Math.abs(d.j-x);(0==b&&w>1||0==w&&b>1||w==b&&w>1)&&(x!=d.j||g!=d.i);){g=b?Math.min(d.i,g)+1:g,x=w?Math.min(d.j,x)+1:x,b=Math.abs(d.i-g),w=Math.abs(d.j-x);var j=(x-1)*i.option.matrix[1]+g,M=i.mapperFunc(j)||j;-1==p.indexOf(M)&&(t(s[j-1]).addClass("hovered"),p.push(M))}v.addClass("hovered"),p.push(c);var y=i.option.margin,P=i.option.radius,k=(d.i-1)*(2*y+2*P)+2*y+P,C=(d.j-1)*(2*y+2*P)+2*y+P;if(1!=p.length){var O=a(i.lineX1,k,i.lineY1,C);i.line.css({width:O.length+10+"px",transform:"rotate("+O.angle+"deg)"}),h||i.line.show()}var D=t('<div class="patt-lines" style="top:'+(C-5)+"px; left:"+(k-5)+'px"></div>');i.line=D,i.lineX1=k,i.lineY1=C,i.holder.append(D),h||i.line.hide()}i.lastPosObj=d}},d=function(t,e){t.preventDefault();var n=l[e.token],r=n.patternAry.join("");n.holder.off(".pattern-move").removeClass("patt-hidden"),r&&(n.option.onDraw(r),n.line.remove(),n.rightPattern&&(r==n.rightPattern?n.onSuccess():(n.onError(),e.error())))};o.prototype={constructor:o,getIdxFromPoint:function(t,e){var n=this.option,r=n.matrix,a=t-this.wrapLeft,o=e-this.wrapTop,i=null,s=n.margin,l=2*n.radius+2*s,p=Math.ceil(a/l),h=Math.ceil(o/l),d=a%l,u=o%l;return p<=r[1]&&h<=r[0]&&d>2*s&&u>2*s&&(i=(h-1)*r[1]+p),{idx:i,i:p,j:h,x:a,y:o}}},i.prototype={constructor:i,option:function(t,e){var n=l[this.token],a=n.option;return e?(a[t]=e,void(("margin"==t||"matrix"==t||"radius"==t)&&r(n))):a[t]},getPattern:function(){return l[this.token].patternAry.join("")},setPattern:function(t){var e=l[this.token],n=e.option,r=n.matrix,a=n.margin,o=n.radius;if(n.enableSetPattern){this.reset(),e.wrapLeft=0,e.wrapTop=0;for(var i=0;i<t.length;i++){var p=t[i]-1,d=p%r[1],u=Math.floor(p/r[1]),c=d*(2*a+2*o)+2*a+o,f=u*(2*a+2*o)+2*a+o;h.call(null,{pageX:c,pageY:f,preventDefault:s,originalEvent:{touches:[{pageX:c,pageY:f}]}},this)}}},enable:function(){var t=l[this.token];t.disabled=!1},disable:function(){var t=l[this.token];t.disabled=!0},reset:function(){var t=l[this.token];t.pattCircle.removeClass("hovered"),t.holder.find(".patt-lines").remove(),t.patternAry=[],t.lastPosObj=null,t.holder.removeClass("patt-error")},error:function(){l[this.token].holder.addClass("patt-error")},checkForPattern:function(t,e,n){var r=l[this.token];r.rightPattern=t,r.onSuccess=e||s,r.onError=n||s}},i.defaults={matrix:[3,3],margin:20,radius:25,patternVisible:!0,lineOnMove:!0,enableSetPattern:!1},e.PatternLock=i}(jQuery,window,document);